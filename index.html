<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Calculate sourdough starter feeding ratios and bread dough formulations with precision. Supports multiple hydration levels, flour types, and timing options.">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 100 100%27><text y=%27.9em%27 font-size=%2790%27>üçû</text></svg>">
  <title>Sourdough Calculator</title>
  <style>
    :root {
      color-scheme: light dark;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f5f7fa;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px;
      text-align: center;
    }

    header h1 {
      font-size: 2.5em;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .subtitle {
      font-size: 1.1em;
      opacity: 0.9;
      font-weight: 300;
    }

    .main-content {
      flex: 1;
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
      width: 100%;
    }

    .tabs {
      display: flex;
      border-radius: 999px;
      background: #e2e8f0;
      padding: 4px;
      margin-bottom: 25px;
      max-width: 420px;
      margin-left: auto;
      margin-right: auto;
    }

    .tab-btn {
      flex: 1;
      border: none;
      background: transparent;
      padding: 10px 16px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      color: #4a5568;
      transition: all 0.2s;
    }

    .tab-btn.active {
      background: white;
      color: #2d3748;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
    }

    .tab-btn span {
      display: block;
      font-size: 11px;
      font-weight: 400;
      opacity: 0.8;
    }

    .calculator-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 25px;
      margin-bottom: 30px;
    }

    .calculator-section {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    h2 {
      color: #34495e;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 3px solid #667eea;
    }

    .input-group {
      margin-bottom: 18px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      color: #555;
      font-weight: 500;
    }

    input[type="number"] {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    input[type="number"]:focus {
      outline: none;
      border-color: #667eea;
    }

    .hydration-buttons,
    .starter-hydration-buttons,
    .dough-hydration-buttons,
    .weight-buttons,
    .starter-pct-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    .starter-pct-buttons {
      grid-template-columns: repeat(3, 1fr);
      /* 3 columns for starter percentage */
    }


    .flour-buttons,
    .time-buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    .hydration-btn,
    .flour-btn,
    .time-btn,
    .weight-btn,
    .starter-pct-btn {
      background: white;
      border: 2px solid #ddd;
      padding: 12px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #555;
      transition: all 0.3s;
      text-align: center;
    }

    @media (hover: hover) {

      .hydration-btn:hover,
      .flour-btn:hover,
      .time-btn:hover,
      .weight-btn:hover,
      .starter-pct-btn:hover {
        border-color: #667eea;
        color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
      }
    }

    .hydration-btn.active,
    .flour-btn.active,
    .time-btn.active,
    .weight-btn.active,
    .starter-pct-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: #667eea;
      color: white;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .hydration-label,
    .flour-label,
    .time-label {
      display: block;
      font-size: 16px;
      font-weight: 600;
    }

    .hydration-ratio,
    .time-ratio {
      display: block;
      font-size: 10px;
      opacity: 0.7;
      margin-top: 2px;
      font-weight: 400;
    }

    .hydration-desc,
    .flour-desc,
    .time-desc {
      display: block;
      font-size: 11px;
      opacity: 0.8;
      margin-top: 3px;
    }

    .results {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      border: 1px solid #e9ecef;
    }

    .results h3 {
      color: #2c3e50;
      margin-bottom: 15px;
      font-size: 1.1em;
    }

    .result-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #dee2e6;
    }

    .result-item:last-child {
      border-bottom: none;
    }

    .result-label {
      font-weight: 500;
      color: #555;
    }

    .result-value {
      font-weight: bold;
      color: #2c3e50;
    }

    .highlight {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px;
      border-radius: 6px;
      margin-top: 10px;
    }

    .highlight .result-item {
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .highlight .result-item:last-child {
      border-bottom: none;
    }

    .highlight .result-label,
    .highlight .result-value {
      color: white;
    }

    .info-text {
      font-size: 0.9em;
      color: #7f8c8d;
      margin-top: 5px;
    }

    footer {
      background: #2d3748;
      color: white;
      padding: 30px;
      text-align: center;
    }

    footer a {
      color: #667eea;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    footer p {
      margin: 5px 0;
    }

    @media (max-width: 768px) {
      header h1 {
        font-size: 2em;
      }

      .hydration-buttons,
      .starter-hydration-buttons,
      .dough-hydration-buttons,
      .flour-buttons,
      .time-buttons,
      .weight-buttons,
      .starter-pct-buttons {
        grid-template-columns: 1fr;
      }
    }

    .hidden {
      display: none;
    }

    /* Auto dark mode */
    @media (prefers-color-scheme: dark) {
      body {
        background: #111827;
        color: #f3f4f6;
      }

      .calculator-section {
        background: #1f2937;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
      }

      h2 {
        color: #f3f4f6;
      }

      label,
      .result-label,
      .result-value {
        color: #e5e7eb;
      }

      .info-text,
      .hydration-ratio,
      .hydration-desc,
      .flour-desc,
      .time-desc,
      .time-ratio {
        color: #9ca3af;
      }

      .results {
        background: #374151;
        border-color: #4b5563;
      }

      .results h3 {
        color: #f3f4f6;
      }

      .result-item {
        border-bottom-color: #4b5563;
      }

      input[type="number"] {
        background: #111827;
        color: white;
        border-color: #4b5563;
      }

      .tabs {
        background: #374151;
      }

      .tab-btn {
        color: #9ca3af;
      }

      .tab-btn.active {
        background: #1f2937;
        color: white;
      }

      .hydration-btn,
      .flour-btn,
      .time-btn,
      .weight-btn,
      .starter-pct-btn {
        background: #374151;
        border-color: #4b5563;
        color: #e5e7eb;
      }

      /* Dark mode hover only on hover-capable devices (prevents sticky hover on mobile) */
      @media (hover: hover) {

        .hydration-btn:hover,
        .flour-btn:hover,
        .time-btn:hover,
        .weight-btn:hover,
        .starter-pct-btn:hover {
          border-color: #667eea;
          color: #a3bffa;
          background: #1f2937;
        }
      }

      /* Ensure active state always wins in dark mode */
      .hydration-btn.active,
      .flour-btn.active,
      .time-btn.active,
      .weight-btn.active,
      .starter-pct-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-color: #667eea;
        color: white;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>üçû Sourdough Calculator</h1>
    <p class="subtitle">Calculate starter feeding and bread baking ratios with precision</p>
  </header>

  <main class="main-content">
    <div class="tabs" role="tablist">
      <button class="tab-btn active" id="tab-starter" onclick="showTab('starter')" role="tab" aria-selected="true" aria-controls="section-starter">
        Starter Feeding
        <span>Ratios & timing</span>
      </button>
      <button class="tab-btn" id="tab-bread" onclick="showTab('bread')" role="tab" aria-selected="false" aria-controls="section-bread">
        Bread Baking
        <span>Dough formulation</span>
      </button>
    </div>

    <div class="calculator-grid">
      <!-- Starter Feeding Calculator -->
      <div class="calculator-section" id="section-starter" role="tabpanel">
        <h2>Starter Feeding Calculator</h2>

        <div class="input-group">
          <label>When do you want your starter ready?</label>
          <div class="time-buttons">
            <button class="time-btn active" onclick="setReadyTime(1, 1, 1)">
              <span class="time-label">4-6 hours</span>
              <span class="time-ratio">1:1:1 ratio</span>
              <span class="time-desc">Fast rise</span>
            </button>
            <button class="time-btn" onclick="setReadyTime(1, 2, 2)">
              <span class="time-label">6-8 hours</span>
              <span class="time-ratio">1:2:2 ratio</span>
              <span class="time-desc">Morning bake</span>
            </button>
            <button class="time-btn" onclick="setReadyTime(1, 3, 3)">
              <span class="time-label">8-10 hours</span>
              <span class="time-ratio">1:3:3 ratio</span>
              <span class="time-desc">Work day</span>
            </button>
            <button class="time-btn" onclick="setReadyTime(1, 4, 4)">
              <span class="time-label">10-12 hours</span>
              <span class="time-ratio">1:4:4 ratio</span>
              <span class="time-desc">Overnight</span>
            </button>
            <button class="time-btn" onclick="setReadyTime(1, 5, 5)">
              <span class="time-label">12-14 hours</span>
              <span class="time-ratio">1:5:5 ratio</span>
              <span class="time-desc">Extended</span>
            </button>
            <button class="time-btn" onclick="setReadyTime(1, 10, 10)">
              <span class="time-label">16-24 hours</span>
              <span class="time-ratio">1:10:10 ratio</span>
              <span class="time-desc">Slow rise</span>
            </button>
          </div>
          <div class="info-text">Based on 75¬∞F / 24¬∞C ambient temperature</div>
        </div>

        <div class="input-group">
          <label for="containerWeightStarter">Container Weight (g):</label>
          <input type="number" id="containerWeightStarter" value="0" min="0" step="0.1" oninput="calculateStarter()" aria-describedby="containerWeightHint">
          <div class="info-text" id="containerWeightHint">Weight of empty container</div>
        </div>

        <div class="input-group">
          <label for="currentStarter">Current Starter + Container (g):</label>
          <input type="number" id="currentStarter" value="50" min="0" step="1" oninput="calculateStarter()" aria-describedby="currentStarterHint">
          <div class="info-text" id="currentStarterHint">Total weight including container</div>
        </div>

        <div class="input-group">
          <label>Hydration:</label>
          <div class="hydration-buttons">
            <button class="hydration-btn" onclick="setStarterHydration(50)">
              <span class="hydration-label">50%</span>
              <span class="hydration-ratio">2:1 flour:water</span>
              <span class="hydration-desc">Stiff Starter</span>
            </button>
            <button class="hydration-btn active" onclick="setStarterHydration(75)">
              <span class="hydration-label">75%</span>
              <span class="hydration-ratio">4:3 flour:water</span>
              <span class="hydration-desc">Firm</span>
            </button>
            <button class="hydration-btn" onclick="setStarterHydration(100)">
              <span class="hydration-label">100%</span>
              <span class="hydration-ratio">1:1 flour:water</span>
              <span class="hydration-desc">Standard</span>
            </button>
            <button class="hydration-btn" onclick="setStarterHydration(125)">
              <span class="hydration-label">125%</span>
              <span class="hydration-ratio">4:5 flour:water</span>
              <span class="hydration-desc">Liquid</span>
            </button>
          </div>
          <input type="hidden" id="hydration" value="75">
          <input type="hidden" id="feedingRatioStarter" value="1">
          <input type="hidden" id="feedingRatioFlour" value="1">
          <input type="hidden" id="feedingRatioWater" value="1">
        </div>

        <div class="results">
          <h3>Add to Your Starter:</h3>
          <div class="result-item">
            <span class="result-label">Starter to Use:</span>
            <span class="result-value" id="starterToUse">50 g</span>
          </div>
          <div class="result-item">
            <span class="result-label">Flour to Add:</span>
            <span class="result-value" id="flourToAdd">75 g</span>
          </div>
          <div class="result-item">
            <span class="result-label">Water to Add:</span>
            <span class="result-value" id="waterToAdd">75 g</span>
          </div>
          <div class="highlight">
            <div class="result-item">
              <span class="result-label">Total Weight + Container:</span>
              <span class="result-value" id="totalWeight">200 g</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Bread Baking Calculator -->
      <div class="calculator-section hidden" id="section-bread" role="tabpanel">
        <h2>Bread Baking Calculator</h2>

        <div class="input-group">
          <label>Target Total Dough Weight:</label>
          <div class="weight-buttons">
            <button class="weight-btn" onclick="setDoughWeight(650)">
              <span class="hydration-label">Small</span>
              <span class="hydration-desc">650g</span>
            </button>
            <button class="weight-btn active" onclick="setDoughWeight(900)">
              <span class="hydration-label">Standard</span>
              <span class="hydration-desc">900g</span>
            </button>
            <button class="weight-btn" onclick="setDoughWeight(1800)">
              <span class="hydration-label">Double</span>
              <span class="hydration-desc">1800g</span>
            </button>
            <button class="weight-btn" onclick="toggleCustomWeight()">
              <span class="hydration-label">Custom</span>
              <span class="hydration-desc">Manual Input</span>
            </button>
          </div>

          <!-- Custom Input Field (Hidden by default) -->
          <div id="customWeightContainer" class="hidden" style="margin-top: 10px;">
            <label for="targetDoughWeight" style="font-size: 0.9em;">Enter Weight (g):</label>
            <input type="number" id="targetDoughWeight" value="900" min="1" step="1" oninput="calculateBread()">
          </div>
        </div>

        <div class="input-group">
          <label>Starter Amount & Rise Time:</label>
          <div class="starter-pct-buttons">
            <button class="starter-pct-btn" onclick="setStarterPercentage(10)">
              <span class="hydration-label">Slow</span>
              <span class="hydration-ratio">10%</span>
              <span class="hydration-desc">Overnight</span>
            </button>
            <button class="starter-pct-btn active" onclick="setStarterPercentage(20)">
              <span class="hydration-label">Standard</span>
              <span class="hydration-ratio">20%</span>
              <span class="hydration-desc">4-6 Hours</span>
            </button>
            <button class="starter-pct-btn" onclick="setStarterPercentage(30)">
              <span class="hydration-label">Fast</span>
              <span class="hydration-ratio">30%</span>
              <span class="hydration-desc">Winter/Fast</span>
            </button>
          </div>
          <input type="hidden" id="starterPercentage" value="20">
        </div>

        <div class="input-group">
          <label>Flour Type:</label>
          <div class="flour-buttons">
            <button class="flour-btn" onclick="setFlourType('ap', 70)">
              <span class="flour-label">All-Purpose</span>
              <span class="flour-desc">Recommended: 70%</span>
            </button>
            <button class="flour-btn active" onclick="setFlourType('bread', 75)">
              <span class="flour-label">Bread Flour</span>
              <span class="flour-desc">Recommended: 75%</span>
            </button>
            <button class="flour-btn" onclick="setFlourType('ww', 80)">
              <span class="flour-label">Whole Wheat</span>
              <span class="flour-desc">Recommended: 80%</span>
            </button>
            <button class="flour-btn" onclick="setFlourType('rye', 90)">
              <span class="flour-label">Rye</span>
              <span class="flour-desc">Recommended: 90%</span>
            </button>
            <button class="flour-btn" onclick="setFlourType('spelt', 72)">
              <span class="flour-label">Spelt</span>
              <span class="flour-desc">Recommended: 72%</span>
            </button>
            <button class="flour-btn" onclick="setFlourType('mix', null)">
              <span class="flour-label">Mixed</span>
              <span class="flour-desc">Manual adjust</span>
            </button>
          </div>
          <input type="hidden" id="flourType" value="bread">
        </div>

        <div class="input-group">
          <label>Starter Hydration:</label>
          <div class="starter-hydration-buttons">
            <button class="hydration-btn" onclick="setBreadStarterHydration(50)">
              <span class="hydration-label">50%</span>
              <span class="hydration-ratio">2:1 flour:water</span>
              <span class="hydration-desc">Stiff</span>
            </button>
            <button class="hydration-btn active" onclick="setBreadStarterHydration(75)">
              <span class="hydration-label">75%</span>
              <span class="hydration-ratio">4:3 flour:water</span>
              <span class="hydration-desc">Firm</span>
            </button>
            <button class="hydration-btn" onclick="setBreadStarterHydration(100)">
              <span class="hydration-label">100%</span>
              <span class="hydration-ratio">1:1 flour:water</span>
              <span class="hydration-desc">Standard</span>
            </button>
            <button class="hydration-btn" onclick="setBreadStarterHydration(125)">
              <span class="hydration-label">125%</span>
              <span class="hydration-ratio">4:5 flour:water</span>
              <span class="hydration-desc">Liquid</span>
            </button>
          </div>
          <input type="hidden" id="starterHydration" value="75">
        </div>

        <div class="input-group">
          <label>Target Dough Hydration:</label>
          <div class="dough-hydration-buttons">
            <button class="hydration-btn" onclick="setDoughHydration(65)">
              <span class="hydration-label">65%</span>
              <span class="hydration-ratio">20:13 flour:water</span>
              <span class="hydration-desc">Bagels</span>
            </button>
            <button class="hydration-btn active" onclick="setDoughHydration(75)">
              <span class="hydration-label">75%</span>
              <span class="hydration-ratio">4:3 flour:water</span>
              <span class="hydration-desc">Standard Loaf</span>
            </button>
            <button class="hydration-btn" onclick="setDoughHydration(80)">
              <span class="hydration-label">80%</span>
              <span class="hydration-ratio">5:4 flour:water</span>
              <span class="hydration-desc">Ciabatta</span>
            </button>
            <button class="hydration-btn" onclick="setDoughHydration(90)">
              <span class="hydration-label">90%</span>
              <span class="hydration-ratio">10:9 flour:water</span>
              <span class="hydration-desc">Focaccia</span>
            </button>
          </div>
          <input type="hidden" id="doughHydration" value="75">
        </div>

        <div class="input-group">
          <label for="saltPercent">Salt (% of flour):</label>
          <input type="number" id="saltPercent" value="2" min="0" max="10" step="0.1" oninput="calculateBread()">
        </div>

        <div class="results">
          <h3>Recipe Ingredients:</h3>
          <div class="result-item">
            <span class="result-label">Net Starter:</span>
            <span class="result-value" id="netStarter">100 g</span>
          </div>
          <div class="result-item">
            <span class="result-label">Flour to Add:</span>
            <span class="result-value" id="additionalFlour">450 g</span>
          </div>
          <div class="result-item">
            <span class="result-label">Water to Add:</span>
            <span class="result-value" id="additionalWater">325 g</span>
          </div>
          <div class="result-item">
            <span class="result-label">Salt:</span>
            <span class="result-value" id="salt">10 g</span>
          </div>
          <div class="highlight">
            <div class="result-item">
              <span class="result-label">Total Dough Weight (calc):</span>
              <span class="result-value" id="totalDough">885 g</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <p>Built for precision sourdough baking | Made by <a href="https://www.dandanilyuk.com" target="_blank">Dan
        Danilyuk</a></p>
    <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">Open source on <a
        href="https://github.com/DanDanilyuk/sourdough_calculator" target="_blank">GitHub</a></p>
  </footer>

  <script>
    function showTab(which) {
      const starterSection = document.getElementById('section-starter');
      const breadSection = document.getElementById('section-bread');
      const tabStarter = document.getElementById('tab-starter');
      const tabBread = document.getElementById('tab-bread');

      if (which === 'starter') {
        starterSection.classList.remove('hidden');
        breadSection.classList.add('hidden');
        tabStarter.classList.add('active');
        tabBread.classList.remove('active');
        tabStarter.setAttribute('aria-selected', 'true');
        tabBread.setAttribute('aria-selected', 'false');
      } else {
        starterSection.classList.add('hidden');
        breadSection.classList.remove('hidden');
        tabStarter.classList.remove('active');
        tabBread.classList.add('active');
        tabStarter.setAttribute('aria-selected', 'false');
        tabBread.setAttribute('aria-selected', 'true');
      }
    }

    function setReadyTime(ratioStarter, ratioFlour, ratioWater) {
      document.getElementById('feedingRatioStarter').value = ratioStarter;
      document.getElementById('feedingRatioFlour').value = ratioFlour;
      // We still set this for reference, though calculateStarter now overrides it with hydration math
      document.getElementById('feedingRatioWater').value = ratioWater;

      const ratioText = ratioStarter + ':' + ratioFlour + ':' + ratioWater + ' ratio';
      const buttons = document.querySelectorAll('.time-btn');
      buttons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.querySelector('.time-ratio').textContent === ratioText) {
          btn.classList.add('active');
        }
      });

      calculateStarter();
    }

    function setFlourType(type, recommendedHydration) {
      document.getElementById('flourType').value = type;

      const labels = { ap: 'All-Purpose', bread: 'Bread Flour', ww: 'Whole Wheat', rye: 'Rye', spelt: 'Spelt', mix: 'Mixed' };
      const buttons = document.querySelectorAll('.flour-btn');
      buttons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.querySelector('.flour-label').textContent === labels[type]) {
          btn.classList.add('active');
        }
      });

      if (recommendedHydration !== null) {
        setDoughHydration(recommendedHydration);
      }
    }

    function setStarterHydration(value) {
      document.getElementById('hydration').value = value;

      const buttons = document.querySelectorAll('#section-starter .hydration-buttons .hydration-btn');
      buttons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.querySelector('.hydration-label').textContent === value + '%') {
          btn.classList.add('active');
        }
      });

      calculateStarter();
    }

    function setBreadStarterHydration(value) {
      document.getElementById('starterHydration').value = value;

      const buttons = document.querySelectorAll('.starter-hydration-buttons .hydration-btn');
      buttons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.querySelector('.hydration-label').textContent === value + '%') {
          btn.classList.add('active');
        }
      });

      calculateBread();
    }

    function setDoughHydration(value) {
      document.getElementById('doughHydration').value = value;

      const buttons = document.querySelectorAll('.dough-hydration-buttons .hydration-btn');
      buttons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.querySelector('.hydration-label').textContent === value + '%') {
          btn.classList.add('active');
        }
      });

      calculateBread();
    }

    function setDoughWeight(weight) {
      // Update buttons
      const buttons = document.querySelectorAll('.weight-btn');
      buttons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.querySelector('.hydration-desc').textContent === weight + 'g') {
          btn.classList.add('active');
        }
      });

      // Hide custom input
      document.getElementById('customWeightContainer').classList.add('hidden');

      // Set value and calculate
      document.getElementById('targetDoughWeight').value = weight;
      calculateBread();
    }

    function toggleCustomWeight() {
      // Update buttons
      const buttons = document.querySelectorAll('.weight-btn');
      buttons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.querySelector('.hydration-label').textContent === 'Custom') {
          btn.classList.add('active');
        }
      });

      // Show custom input
      const container = document.getElementById('customWeightContainer');
      container.classList.remove('hidden');

      // Focus the input
      const input = document.getElementById('targetDoughWeight');
      input.focus();
      input.select();
    }

    function setStarterPercentage(percent) {
      document.getElementById('starterPercentage').value = percent;

      const buttons = document.querySelectorAll('.starter-pct-btn');
      buttons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.querySelector('.hydration-ratio').textContent === percent + '%') {
          btn.classList.add('active');
        }
      });

      calculateBread();
    }

    function calculateStarter() {
      const containerWeight = parseFloat(document.getElementById('containerWeightStarter').value) || 0;
      // Net starter is Current Total - Container.
      const currentStarterTotal = parseFloat(document.getElementById('currentStarter').value) || 0;
      const hydration = parseFloat(document.getElementById('hydration').value) || 100;

      const ratioStarter = parseFloat(document.getElementById('feedingRatioStarter').value) || 1;
      const ratioFlour = parseFloat(document.getElementById('feedingRatioFlour').value) || 1;

      // FIX: Calculate water ratio based on flour and hydration
      const ratioWater = ratioFlour * (hydration / 100);

      // Determine how much starter we are actually feeding
      const netStarter = Math.max(0, currentStarterTotal - containerWeight);

      // Feeding based on what we HAVE, not what we WANT
      const starterToUse = netStarter;
      const flourToAdd = starterToUse * (ratioFlour / ratioStarter);
      const waterToAdd = starterToUse * (ratioWater / ratioStarter);

      const totalWeight = starterToUse + flourToAdd + waterToAdd + containerWeight;

      document.getElementById('starterToUse').textContent = Math.max(0, starterToUse).toFixed(1) + ' g';
      document.getElementById('flourToAdd').textContent = Math.max(0, flourToAdd).toFixed(1) + ' g';
      document.getElementById('waterToAdd').textContent = Math.max(0, waterToAdd).toFixed(1) + ' g';
      document.getElementById('totalWeight').textContent = Math.max(0, totalWeight).toFixed(1) + ' g';
    }

    function calculateBread() {
      const targetDoughWeight = parseFloat(document.getElementById('targetDoughWeight').value) || 0;
      const starterPercentage = parseFloat(document.getElementById('starterPercentage').value) || 20;
      const starterHydration = parseFloat(document.getElementById('starterHydration').value) || 100;
      const doughHydration = parseFloat(document.getElementById('doughHydration').value) || 75;
      const saltPercent = parseFloat(document.getElementById('saltPercent').value) || 2;

      // Math for Baker's Percentage with a fixed dough weight
      // Total % = 100% (flour) + water% + starter% + salt%
      // But Wait: "starter%" is usually % of total flour.
      // Net Formula:
      // Total Flour (TF) comes from two places: Raw flour + Flour in starter.
      // We want the SUM of all ingredients to equal targetDoughWeight.

      // Let Final Flour = F_total (including starter flour)
      // Total Water = F_total * hydration
      // Salt = F_total * saltPercent
      // Total Dough = F_total + Total Water + Salt
      // Total Dough = F_total * (1 + hydration + saltPercent)

      // So, F_total = TargetDough / (1 + hydration/100 + salt/100)
      const totalFlour = targetDoughWeight / (1 + (doughHydration / 100) + (saltPercent / 100));

      // Now we determine how much of that F_total comes from the starter.
      // Standard Baker's math: Starter amount is X% of Total Flour.
      // Starter Weight = TotalFlour * (starterPercentage / 100)
      const starterWeight = totalFlour * (starterPercentage / 100);

      // Breakdown starter into flour/water
      const flourInStarter = starterWeight / (1 + starterHydration / 100);
      const waterInStarter = starterWeight - flourInStarter;

      // Calculate remaining ingredients to add
      const flourToAdd = totalFlour - flourInStarter;

      // Total water required = TotalFlour * doughHydration
      const totalWater = totalFlour * (doughHydration / 100);
      const waterToAdd = totalWater - waterInStarter;

      const salt = totalFlour * (saltPercent / 100);

      // Display
      document.getElementById('netStarter').textContent = Math.max(0, starterWeight).toFixed(1) + ' g';
      document.getElementById('additionalFlour').textContent = Math.max(0, flourToAdd).toFixed(1) + ' g';
      document.getElementById('additionalWater').textContent = Math.max(0, waterToAdd).toFixed(1) + ' g';
      document.getElementById('salt').textContent = Math.max(0, salt).toFixed(1) + ' g';

      // Check calc
      const checkTotal = starterWeight + flourToAdd + waterToAdd + salt;
      document.getElementById('totalDough').textContent = Math.max(0, checkTotal).toFixed(1) + ' g';
    }

    // Initialize
    calculateStarter();
    calculateBread();
  </script>

</body>

</html>